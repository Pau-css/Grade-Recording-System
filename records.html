<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Records - Grade Recording System</title>
    <style>
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); margin:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; min-height:100vh; display:flex; flex-direction:column;}
header { background: linear-gradient(135deg, #16213e 0%, #0f3460 100%); color:white; text-align:center; padding:40px 20px; box-shadow:0 10px 30px rgba(0,0,0,0.3);}
header h1 { font-size:2.2em; margin:0; text-shadow:0 2px 10px rgba(0,0,0,0.5);}
nav { background: rgba(22,33,62,0.95); backdrop-filter:blur(10px); padding:15px 0; box-shadow:0 4px 20px rgba(0,0,0,0.2);}
nav ul { display:flex; justify-content:center; gap:40px; list-style:none; margin:0; padding:0;}
nav a { color:#ecf0f1; text-decoration:none; font-weight:600; padding:10px 25px; border-radius:25px; transition:all 0.3s ease; font-size:15px; border:2px solid transparent;}
nav a:hover { background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); transform:translateY(-2px); box-shadow:0 8px 25px rgba(102,126,234,0.3);}
.container { max-width:1000px; margin:40px auto; padding:0 20px;}
table { width:100%; border-collapse:collapse; background: rgba(255,255,255,0.95); border-radius:15px; overflow:hidden; box-shadow:0 25px 60px rgba(0,0,0,0.2);}
th,td { padding:15px; text-align:left; border-bottom:1px solid rgba(0,0,0,0.1);}
th { background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white;}
.actions a { margin-right:10px; padding:8px 15px; border-radius:8px; text-decoration:none; color:white; font-weight:600;}
.edit { background:#27ae60;}
.edit:hover { background:#2ecc71;}
.delete { background:#e74c3c;}
.delete:hover { background:#c0392b;}
.message { padding:15px; border-radius:10px; margin-bottom:20px; color:white; font-weight:600;}
.success { background:#27ae60;}
.error { background:#e74c3c;}
@media(max-width:768px){table,th,td{font-size:14px;} nav ul{flex-direction:column; gap:15px; align-items:center;}}
    </style>
</head>
<body>

<header>
    <h1>üìã Student Records</h1>
</header>

<nav>
    <ul>
        <li><a href="subjects.html">üìö Back to Subjects</a></li>
        <li><a href="add_record.html">‚ûï Add Record</a></li>
    </ul>
</nav>

<div class="container">
    <table>
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Grade</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="gradesContainer"></tbody>
    </table>
</div>

<footer>
    <p>&copy; 2026 Grade Recording System</p>
</footer>

<script type="module">
    import { db } from './firebase.js';
    import { collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';
    import { deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

    
    window.deleteRecord = async function deleteRecord(gradeId) {
        try {
            await deleteDoc(doc(db, "grades", gradeId)); 
            alert("‚úÖ Grade deleted successfully!");
            location.reload();
        } catch (error) {
            console.error("Error deleting document: ", error);
            alert("‚ùå Error deleting the record.");
        }
    }

    const params = new URLSearchParams(window.location.search);
    const subjectId = params.get("subject_id");
    const gradesContainer = document.getElementById("gradesContainer");

    async function fetchGrades() {
        const q = query(collection(db, "grades"), where("subject_id", "==", subjectId));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
            gradesContainer.innerHTML = "<tr><td colspan='3'>No records found.</td></tr>";
        } else {
            querySnapshot.forEach((doc) => {
                const grade = doc.data();
                const gradeId = doc.id; 

                gradesContainer.innerHTML += `
                    <tr>
                        <td>${grade.student_name}</td>
                        <td>${grade.grade}</td>
                        <td class="actions">
                            <a href="edit_record.html?grade_id=${gradeId}" class="edit">Edit</a>
                            <button class="delete" onclick="deleteRecord('${gradeId}')">Delete</button>
                        </td>
                    </tr>
                `;
            });
        }
    }

    fetchGrades(); 
</script>

</body>
</html>
